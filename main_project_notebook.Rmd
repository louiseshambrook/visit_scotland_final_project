---
title: "Visit Scotland Final Project"
output: html_notebook
author: "Louise Shambrook"
---

### Loading required libraries
```{r}
library(tidyverse)
library(janitor)
library(lubridate)
```

### Loading cleaned data
```{r}
activities <- read_csv("clean_data/activities_clean.csv")
accomodation <- read_csv("clean_data/accomodation_clean.csv")
demographics <- read_csv("clean_data/demographics_clean.csv")
location <- read_csv("clean_data/location_clean.csv")
regional_domestic <- read_csv("clean_data/regional_domestic_clean.csv")
transport <- read_csv("clean_data/transport_clean.csv")
```

### Notes on data cleaning
I will be removing the feature_code from all datasets, as this is the country code for Scotland. I will also be removing the column measurement, as this is irrelevant and duplicated information. 

On all datasets, there is an "All" response. The data are survey responses, and therefore it is reasonable to assume that "all" was an actual response. Therefore, I will not drop it / change it to NA, but it also does not give any insight to my analysis and I will be removing it from my plots etc.

For most of the datasets, I have simplified the units and reordered the columns, so the datasets are easier to interpret.

For the activities dataset, I have simplified the responses, and dropped the original column.

For the transport dataset, I have grouped the types, and dropped the original column.

For the regional_domestic dataset, I have split the unit column into the nights/visits, and pounds, as the nights/visits are measured in thousands, and the pounds are measured in millions.

For the location dataset, I have also simplified the responses, and dropped the original column. 


### Business questions / main questions

- What kind of tourism activity generates the highest income for Scotland?
- Which kind of activity generates the most visits to sites?
- Is there a particular key demographic of visitors we should be focusing on? Who spends the most? Who visits the most?
- What type of locations receive the most visits? What kinds of locations do people spend the most in?
- Is there a particular method of travel our visitors arrive by? Some of our locations are remote and not easily accessible by public transport, so this would be good information to have.
- When looking at regional tourism, what insights can we gain? Where are our visitors from? How do they differ in the money they spend, nights they spend in Scotland, or number of visits they do?
- What type of accomodation is most popular? Is there a difference by location?
- How have general tourism rates changed over time?
- Is there any way to predict spending and visits for Visit Scotland?

### Notes on Visit Scotland


### Data wrangling / Exploratory data analysis

```{r}
summary(accomodation)
summary(activities)
summary(demographics)
summary(domestic_tourism)
summary(location)
summary(transport)
# checking for NA values (aside from the "all" values)

head(activities)
head(location)
head(transport)
head(domestic_tourism)
head(accomodation)
```

## Q1.
```{r}
# What kind of tourism activity generates the highest income for Scotland?
activities %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  group_by(activity_type) %>%
  summarise(highest_income = sum(value)) %>%
  arrange(desc(highest_income))

```

## Q2.
```{r}
# Which kind of activity generates the most visits to sites?
activities %>%
  filter(breakdown_of_domestic_tourism == "Visits") %>%
  group_by(activity_type) %>%
  summarise(highest_income = sum(value)) %>%
  arrange(desc(highest_income))
```

## Q3. 
```{r}
# Is there a particular key demographic of visitors we should be focusing on?
# as there is no inter-relating data (when you isolate one variable, there is no
# data for the others), I will have to analyse each variable individually.

demographics %>%
  filter(age != "All" & breakdown_of_domestic_tourism == "Visits") %>%
  group_by(age) %>%
  summarise(most_visits = sum(value)) %>%
  arrange(desc(most_visits))

demographics %>%
  filter(age != "All" & breakdown_of_domestic_tourism != "Visits") %>%
  group_by(age) %>%
  summarise(most_spend = sum(value)) %>%
  arrange(desc(most_spend))

demographics %>%
  filter(marital_status != "All" & breakdown_of_domestic_tourism == "Visits") %>%
  group_by(marital_status) %>%
  summarise(most_visits = sum(value)) %>%
  arrange(desc(most_visits))

# This doesn't seem very relevant; it's a binary definer. Especially with the younger generation, this may not be very important?

demographics %>%
  filter(gender != "All" & breakdown_of_domestic_tourism == "Visits") %>%
  group_by(gender) %>%
  summarise(most_visits = sum(value)) %>%
  arrange(desc(most_visits))

# This is pretty much the same as with married. They're pretty even, and I'm not sure they'll matter too much.

demographics %>%
  filter(employment_status != "All" & breakdown_of_domestic_tourism == "Visits") %>%
  group_by(employment_status) %>%
  summarise(most_visits = sum(value)) %>%
  arrange(desc(most_visits))

# Most people are employed, perhaps not unexpected, as various levels of employment were not available.

demographics %>%
  filter(children != "All" & breakdown_of_domestic_tourism == "Visits") %>%
  group_by(children) %>%
  summarise(most_visits = sum(value)) %>%
  arrange(desc(most_visits))

# Most people report no to children.

demographics %>%
  filter(access_to_car != "All" & breakdown_of_domestic_tourism == "Visits") %>%
  group_by(access_to_car) %>%
  summarise(most_visits = sum(value)) %>%
  arrange(desc(most_visits))

# This is an interesting and useful one. Further down, there is a question about travel, and here by far the majority report having access to a car.

demographics %>%
  filter(social_grade != "All" & breakdown_of_domestic_tourism == "Visits") %>%
  group_by(social_grade) %>%
  summarise(most_visits = sum(value)) %>%
  arrange(desc(most_visits))

# This mostly speaks for itself; the biggest caveat to this is that there was no data dictionary with this dataset, so I can only assume that it goes top down, but this is not known.



```

Q 3.2
```{r}
# Who spends the most?
demographics %>%
  filter(breakdown_of_domestic_tourism == "Expenditure" & age != "All") %>%
  group_by(age) %>%
  summarise(highest_spend = sum(value)) %>%
  arrange(desc(highest_spend))

demographics %>%
  filter(breakdown_of_domestic_tourism == "Expenditure" & marital_status != "All") %>%
  group_by(marital_status) %>%
  summarise(highest_spend = sum(value)) %>%
  arrange(desc(highest_spend))

demographics %>%
  filter(breakdown_of_domestic_tourism == "Expenditure" & gender != "All") %>%
  group_by(gender) %>%
  summarise(highest_spend = sum(value)) %>%
  arrange(desc(highest_spend))

demographics %>%
  filter(breakdown_of_domestic_tourism == "Expenditure" & employment_status != "All") %>%
  group_by(employment_status) %>%
  summarise(highest_spend = sum(value)) %>%
  arrange(desc(highest_spend))

demographics %>%
  filter(breakdown_of_domestic_tourism == "Expenditure" & children != "All") %>%
  group_by(children) %>%
  summarise(highest_spend = sum(value)) %>%
  arrange(desc(highest_spend))

# The direct answer is people who identify as married - but there are some caveats to this answer. It is only possible to explore one variable at a time, and therefore, the identity of 'married' should be questioned. Additionally, because of the possible survey responses, marital_status only has two choices, whereas age is divided into decades starting at 16. So to best compare, age should be split/merged into two categories, or age is really the only identifier, as it has a range of reasonable options. 
```

Q 3.3
```{r}
# Who visits the most?
demographics %>%
  filter(breakdown_of_domestic_tourism == "Visits" & age != "All") %>%
  group_by(age) %>%
  summarise(most_visits = sum(value)) %>%
  arrange(desc(most_visits))

demographics %>%
  filter(breakdown_of_domestic_tourism == "Visits" & marital_status != "All") %>%
  group_by(marital_status) %>%
  summarise(most_visits = sum(value)) %>%
  arrange(desc(most_visits))

demographics %>%
  filter(breakdown_of_domestic_tourism == "Visits" & gender != "All") %>%
  group_by(gender) %>%
  summarise(most_visits = sum(value)) %>%
  arrange(desc(most_visits))

demographics %>%
  filter(breakdown_of_domestic_tourism == "Visits" & employment_status != "All") %>%
  group_by(employment_status) %>%
  summarise(most_visits = sum(value)) %>%
  arrange(desc(most_visits))

demographics %>%
  filter(breakdown_of_domestic_tourism == "Visits" & children != "All") %>%
  group_by(children) %>%
  summarise(most_visits = sum(value)) %>%
  arrange(desc(most_visits))

# Answer here is "no- without children.". But there is the same caveat as with the question above. 
```

## Q4.
```{r}
# What type of locations receive the most visits?
location %>%
  filter(type_of_location_visited != "Other") %>%
  group_by(type_of_location_visited) %>%
  summarise(total_visits = sum(value)) %>%
  arrange(desc(total_visits))

```

Q4.2
```{r}
# What kinds of locations do people spend the most in?
location %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  group_by(type_of_location_visited) %>%
  summarise(total_spend = sum(value)) %>%
  arrange(desc(total_spend))
```

## Q5
```{r}
# Is there a particular method of travel our visitors arrive by?
transport %>%
  filter(breakdown_of_domestic_tourism == "Visits" & travel_type != "Other") %>%
  group_by(travel_type) %>%
  summarise(total_visits = sum(value)) %>%
  arrange(desc(total_visits))

# According to my analysis, most people use a car. This is especially underpinned by the demographics, where xx people report having access to a car.

# Note: the question / answer / analysis here from above, from demographics, with access_to_car, would be good to cover under transport.

```

## Q6
```{r}
# When looking at regional tourism, what insights can we gain? 
# How do they differ in
# the money they spend
# nights they spend in Scotland, or
# number of visits they do?

regional_domestic %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  group_by(region_of_residence) %>%
  summarise(total_spend = sum(value))

regional_domestic %>%
  filter(breakdown_of_domestic_tourism == "Nights") %>%
  group_by(region_of_residence) %>%
  summarise(total_units = sum(value))
  
regional_domestic %>%
  filter(breakdown_of_domestic_tourism == "Visits") %>%
  group_by(region_of_residence) %>%
  summarise(total_units = sum(value))

# by spend, england is the biggest.
# by nights, england is also the biggest - but the difference between england and scotland is less.
# by visits, scotland is bigger than england. This indicates local visiting.
```

Q 6.1 
```{r}
# Where are our visitors from?
regional_domestic %>%
  group_by(region_of_residence) %>%
  summarise(breakdown_of_visit_countries = sum(value)) %>%
  arrange(desc(breakdown_of_visit_countries))

# Most visitors come from all over GB, i.e. including Wales. (it doesn't state the UK, but GB - but in general terms GB and UK are used interchangably - however, without a data dictionary, I'll have to go by the wording).

regional_domestic %>%
  group_by(region_of_residence, breakdown_of_domestic_tourism) %>%
  summarise(breakdown_of_visit_countries = sum(value))

# This provides a nicer breakdown.
```

## Q7.
```{r}
# What type of accomodation is most popular?
accomodation %>%
  group_by(accommodation_type_and_occupancy) %>%
  summarise(popular_accomodation = sum(value)) %>%
  arrange(desc(popular_accomodation))

# Taking the direct result, is hotels. But I think there are duplicates, somehow so it may need cleaning, and additionally, this is reported in percentage but I've only summed it so I can't report it like this - I'll need to do some further cleaning / wrangling.

# Note: these are reported in percentage; this is important to note on the plots and when talking about the figures

# Note: this is like the demographics; where there is data in one variables, the others have NA, i.e. 'All'.
```

Q 7.1
```{r}
# Is there a difference by location?
accomodation %>%
  filter(location != "Other") %>%
  group_by(location, accommodation_type) %>%
  summarise(popular_accomodation = sum(value)) %>%
  arrange(desc(popular_accomodation))

# So, people are staying in cities.

```

## Q8.
```{r}
# How have general tourism rates changed over time?
activities %>%
  filter(breakdown_of_domestic_tourism == "Visits") %>%
  ggplot(aes(x = year, y = value)) +
  geom_col()

demographics %>%
  filter(breakdown_of_domestic_tourism == "Visits") %>%
  ggplot(aes(x = year, y = value)) +
  geom_col()

location %>%
  filter(breakdown_of_domestic_tourism == "Visits") %>%
  ggplot(aes(x = year, y = value)) +
  geom_col()

# There's a trend of visits increasing in 2017, and declining again.

activities %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  ggplot(aes(x = year, y = value)) +
  geom_col()

demographics %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  ggplot(aes(x = year, y = value)) +
  geom_col()

location %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  ggplot(aes(x = year, y = value)) +
  geom_col()

# Spend is more fluctuating. 

```


### Data visualisations / Plots






## Plot set # 1 - transport
```{r}
# "Is there a particular method of travel our visitors arrive by?".

transport %>%
  filter(breakdown_of_domestic_tourism == "Visits" & travel_type != "Other") %>%
  group_by(travel_type) %>%
  summarise(total_visits = sum(value)) %>%
  ggplot(aes(x = travel_type, y = total_visits, fill = "blue")) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none") +
  labs(x = "Type of transport",
       y = "Total visits (million)",
       title = "Most popular method of travel for visits 2013-2019") +
  scale_fill_manual(values = "#af006e")

```
These are the sum of million visits in 2019, where visitors reported travelling by X.


```{r}
demographics %>%
  filter(access_to_car != "All" & breakdown_of_domestic_tourism == "Visits") %>%
  ggplot(aes(x = year, y = value, fill = access_to_car)) +
  geom_col(position = "dodge") +
  labs(x = "Year",
       y = "Total visits (million)",
       title = "Visitors reporting having access to a car 2013-2019",
       fill = "Access to car") +
  scale_fill_manual(values = c("Access to car (1+)" = "#af006e",
                               "No access to car (0)" = "#63003e"))
```
This is underpinned by the finding that across the the (unit) million visits between 2013 and 2019, the majority of visitors report having access to a car.


## Plot set # 2 - Locations
```{r}
# "what type of locations receive the most visits?"

location %>%
  filter(breakdown_of_domestic_tourism == "Visits"
         & type_of_location_visited != "Other") %>%
  group_by(type_of_location_visited) %>%
  summarise(total_visits = sum(value)) %>%
  ggplot(aes(x = type_of_location_visited, y = total_visits, fill = "blue")) +
  geom_col() +
  theme(legend.position = "none") +
  labs(x = "Type of location",
       y = "Total visits (million)",
       title = "Types of location and frequency of visits 2013-2019") +
  scale_fill_manual(values = "#af006e")
```
The sum of million visits in 2019 by location. 

```{r}
# "what kinds of locations do people spend the most in?"
location %>%
  filter(breakdown_of_domestic_tourism == "Expenditure"
         & type_of_location_visited != "Other") %>%
  group_by(type_of_location_visited) %>%
  summarise(total_visits = sum(value)) %>%
  ggplot(aes(x = type_of_location_visited, y = total_visits, fill = "blue")) +
  geom_col() +
  theme(legend.position = "none") +
  labs(x = "Type of location",
       y = "Total spend (million £)",
       title = "Types of location with highest spend 2013-2019") +
  scale_fill_manual(values = "#af006e")
```
Sum of spend in 2019 in millions, by location.

```{r}
accomodation %>%
  filter(location != "Other") %>%
  group_by(location, accommodation_type) %>%
  summarise(popular_accomodation = sum(value)/100) %>%
  arrange(desc(popular_accomodation)) %>%
  ggplot(aes(x = location, y = popular_accomodation, fill = "blue")) +
  geom_col() +
  theme(legend.position = "none") +
  labs(x = "Type of location",
       y = "Percentage",
       title = "Types of location by average occupancy (accommodation) 2013-2019") +
  scale_fill_manual(values = "#af006e")
```
This lines up with accommodation choices; in 2019, most people chose to visit urban areas.
(note to self: this also answers 'Is there a difference (in accommodation) by location?')
NOTE - this is the one where it's broken down by percentage.


## Plot set # 3 - accommodation
```{r}
# "What type of accomodation is most popular?"

accomodation %>%
  filter(occupancy_type != "Room Occupancy") %>%
  group_by(accommodation_type, occupancy_type) %>%
  summarise(popular_accomodation = sum(value)/100) %>%
  ggplot(aes(x = accommodation_type, y = popular_accomodation, fill = "blue")) +
  geom_col() +
  theme(legend.position = "none") +
  labs(x = "Type of accommodation",
       y = "Percentage",
       title = "Types of accommodation by average occupancy 2013-2019") +
  scale_fill_manual(values = "#af006e")
  
```
2012-2019; percentage occupancy.. ? hotel is by far the highest.

```{r}
accomodation %>%
  filter(location != "Other" & location == "Urban area") %>%
  group_by(location, accommodation_type) %>%
  summarise(popular_accomodation = sum(value)/100) %>%
  arrange(desc(popular_accomodation)) %>%
  ggplot(aes(x = accommodation_type, y = popular_accomodation, fill = accommodation_type)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(x = "Type of accommodation",
       y = "Percentage",
       title = "Types of accommodation by area 2013-2019") +
  scale_fill_manual(values = c("Caravan & Camping Parks" = "#af006e",
                               "Guest House/B&B" = "#af004e",
                               "Hostels" = "#af006e",
                               "Hotels" = "#af004e",
                               "Self Catering" = "#af006e"))

```
2019 data, from location set. When breaking down by location (as above), an interesting finding is that in the urban area, B&B's are just as popular as hotels. Maybe down to a certain B&B site?


## Plot set # 4 - activities
```{r}
# What kind of tourism activity generates the highest income?
activities %>%
  filter(breakdown_of_domestic_tourism == "Expenditure" & activity_type != "Other") %>%
  group_by(activity_type) %>%
  summarise(highest_income = sum(value)) %>%
  ggplot(aes(x = activity_type, y = highest_income, fill = "blue")) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none") +
  labs(x = "Type of activity",
       y = "Sum of spend (million £)",
       title = "Sum of spend on types of activity 2013-2019") +
  scale_fill_manual(values = "#af006e")
```
2013-2019, sum of value in million pounds. Highest is eating out (with shopping and visiting family/friends following)

```{r}
# Which kind of activity generates the most visits?
activities %>%
  filter(breakdown_of_domestic_tourism == "Visits" & activity_type != "Other") %>%
  group_by(activity_type) %>%
  summarise(highest_income = sum(value)) %>%
  ggplot(aes(x = activity_type, y = highest_income, fill = "blue")) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none") +
  labs(x = "Type of activity",
       y = "Sum of visits",
       title = "Sum of vists distributed across types of activity 2013-2019") +
  scale_fill_manual(values = "#af006e")
```
2013-2019, sum of million visits. Highest is visits with family/friends. Eating out coming in second, and outdoor leisure in third.


## Plot set # 5 - demographics 


```{r}
# Is there a particular key demographic of visitors we should be focusing on?

demographics %>%
  filter(age != "All" & breakdown_of_domestic_tourism == "Visits") %>%
  group_by(age) %>%
  summarise(most_visits = sum(value)) %>%
  ggplot(aes(x = age, y = most_visits, fill = "blue")) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none") +
  labs(x = "Age group",
       y = "Sum of visits (millions)",
       title = "Sum of vists distributed across age groups 2013-2019") +
  scale_fill_manual(values = "#af006e")
```
Yes, and no. The data from this dataset isn't great for analysis, because a lot of inferences have to be drawn. A key insight to be drawn from this is to complete further research / get better data.

With that said - age is a good variable and gives good insights. Across pretty much everything, the reflection from the data is that the younger generations are the ones attending and spending money.

NOTE TO MYSELF - if I have time, dig further into this, across the different years / visits / spends.


```{r}
# Who spends the most?
demographics %>%
  filter(breakdown_of_domestic_tourism == "Expenditure" & marital_status != "All") %>%
  group_by(marital_status) %>%
  summarise(highest_spend = sum(value)) %>%
  ggplot(aes(x = marital_status, y = highest_spend, fill = "blue")) +
  geom_col() +
  theme(legend.position = "none") +
  labs(x = "Age group",
       y = "Sum of spend (million £)",
       title = "Sum of spend distributed across age groups 2013-2019") +
  scale_fill_manual(values = "#af006e")
```
This is where the data is limited, because the survey / options for respondents was limited, so marital_status can't really be fairly compared. However, going by the data strictly (because this does still reflect something, and even when grouping age so that they could be compared, the "married" response comes out higher).


```{r}
# Who visits the most?
demographics %>%
  filter(breakdown_of_domestic_tourism == "Visits" & children != "All") %>%
  group_by(children) %>%
  summarise(most_visits = sum(value)) %>%
  ggplot(aes(x = children, y = most_visits, fill = "blue")) +
  geom_col() +
  theme(legend.position = "none") +
  labs(x = "Age group",
       y = "Sum of visits (millions)",
       title = "Sum of vists distributed across age groups 2013-2019") +
  scale_fill_manual(values = "#af006e")
```
This is the same issue, but also response / relevance, as the above.


```{r}
# code to group the age column into two groups for analysing
demographics %>%
  select(year, value, unit, breakdown_of_domestic_tourism, age) %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  mutate(age_category = case_when(age == "16-24 years" ~ "low",
                             age == "25-34 years" ~ "low",
                             age == "35-44 years" ~ "low",
                             age == "45-54 years" ~ "high",
                              age == "54-64 years" ~ "high",
                              age == "65 years and over" ~ "high",
                              age == "All" ~ "Other")) %>%
  filter(age_category == "low") %>%
  summarise(most_visits = sum(value))
  
```
498 (lower half) vs 290 (higher half)


## Plot set # 6 - regional demographics
```{r}
# When looking at regional tourism, what insights can we gain? Where are our visitors from? How do they differ in the money they spend, nights they spend in Scotland, or number of visits they do?

regional_domestic %>%
  filter(breakdown_of_domestic_tourism == "Nights") %>%
  ggplot(aes(x = region_of_residence, y = value, fill = breakdown_of_domestic_tourism)) +
  geom_col(position = "dodge") +
  theme(legend.position = "none") +
  labs(x = "Age group",
       y = "Sum of visits",
       title = "Sum of vists distributed across age groups 2013-2019") +
  scale_fill_manual(values = "#af006e")

regional_domestic %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  ggplot(aes(x = region_of_residence, y = value, fill = breakdown_of_domestic_tourism)) +
  geom_col(position = "dodge") +
  theme(legend.position = "none") +
  labs(x = "Age group",
       y = "Sum of visits",
       title = "Sum of vists distributed across age groups 2013-2019") +
  scale_fill_manual(values = "#af006e")

regional_domestic %>%
  filter(breakdown_of_domestic_tourism == "Visits") %>%
  ggplot(aes(x = region_of_residence, y = value, fill = breakdown_of_domestic_tourism)) +
  geom_col(position = "dodge") +
  theme(legend.position = "none") +
  labs(x = "Age group",
       y = "Sum of visits",
       title = "Sum of vists distributed across age groups 2013-2019") +
  scale_fill_manual(values = "#af004e")
```


## Plot set # 7 - change over time
```{r}
# How have general tourism rates changed over time?

transport %>%
  filter(breakdown_of_domestic_tourism == "Visits") %>%
  group_by(year) %>%
  summarise(total_year = sum(value)) %>%
  ggplot(aes(x = year, y = total_year)) +
  geom_line() +
  theme(legend.position = "none") +
  labs(x = "Year",
       y = "Sum of visits (millions)",
       title = "Tourism rates (visits) 2013-2019")

demographics %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  group_by(year) %>%
  summarise(total_year = sum(value)) %>%
  ggplot(aes(x = year, y = total_year)) +
  geom_line() +
  theme(legend.position = "none") +
  labs(x = "Year",
       y = "Sum of spend (million £)",
       title = "Tourism rates (spend) 2013-2019")
```
The *general* picture over time, is that for visits, it increases until 2017, and then declines (some more than others).
For expenditure, it increases until 2017, declines in 2018, and increases again in 2019.

NOTE TO SELF - I should dig into the individual datasets and see if there are any other developments to highlight, if I have time.

## Plot set # 8 - How to predict change (TO BE ADDED)

### - Preparing data for modelling notes
- before asking for help, try:
add a surrogate key to each datasset using
mutate()
row_numbe()

(possibly delete the previous datasets I create for python)

```{r}
activities_test_two <- activities %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  mutate(activity_id = row_number()) %>%
  relocate(activity_id, .before = year) %>%
  select(activity_id, year, value, activity_type) %>%
  group_by(year, activity_type) %>%
  summarise(income_per_year = sum(value))

transport_test_two <- transport %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  mutate(transport_id = row_number()) %>%
  relocate(transport_id, .before = year) %>%
  select(transport_id, year, value, travel_type) %>%
  group_by(year, travel_type) %>%
  mutate(income_per_year = sum(value)) 

joined_table <- inner_join(activities_test_two, transport_test_two, by = "year")

joined_table %>%
  group_by(year, activity_type, travel_type) %>%
  summarise(income_per_year = sum(value.x))
```

Another idea I had, was adding together income
this may be duplicate values - but still?
```{r}
activities %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  group_by(year) %>%
  summarise(total_income_per_year = sum(value))

demographics %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  group_by(year) %>%
  summarise(total_income_per_year = sum(value))

location %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  group_by(year) %>%
  summarise(total_income_per_year = sum(value))
```
Continuing on from this idea
I will focus on activities and location, just to make my life easier
It seems like I could shape the data to join it, i.e. location has 8 observations per year, and activities has 16
So I can either
Double up (which is what I don't want to do)
Or I can go the other way, that I considered, and join them together into 8, so they *should* join together nicely?

First, I'll check for how many observations there are per year
```{r}
activities %>%
  filter(breakdown_of_domestic_tourism == "Expenditure" & year == "2019")

location %>%
    filter(breakdown_of_domestic_tourism == "Expenditure" & year == "2019")
```
Checking through all the years, there are indeed 8 and 16.

So, these are the steps I will do.

1. stick to activities and location
2. change the cleaning of location back to differentiate between the seasides
3. mutate the activity down to 8 types
4. join them together, by year
5. add the values together
6. complete a linear regression in R


```{r}
# cleaning data to join - test
activities_redone <- activities %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  mutate(activity_type = case_when(activity_type == "Shopping" ~ "Shopping",
                                   activity_type == "Watch live sports" ~  "Live entertainment",
                                   activity_type == "Night out" ~  "Evening out",
                                   activity_type == "Attend personal event" ~ "Family/friends",
                                   activity_type == "Leisure activity" ~ "Leisure activity",
                                   activity_type == "Sports participation" ~ "Leisure activity",
                                   activity_type == "Attend public event" ~ "Live entertainment",
                                   activity_type == "Eating out" ~  "Evening out",
                                   activity_type == "Day out (spa)" ~ "Day trip",
                                   activity_type == "Outdoor leisure activity" ~ "Leisure activity",
                                   activity_type == "Visitor attraction" ~  "Visit attraction",
                                   activity_type == "Day out" ~ "Day trip",
                                   activity_type == "Entertainment - cinema etc." ~  "Live entertainment",
                                   activity_type == "Day trip - leisure" ~  "Day trip",
                                   activity_type == "Visit family/friends" ~  "Family/friends",
                                   activity_type == "Other" ~ "Other")) 

```

```{r}
# test join dataset
joined_set <- inner_join(activities_redone, location_redone, by = "year")

joined_set %>%
  arrange(year)
```
I think this is definitely the right track.

I think I'm going to do it again, for the last time, with some differences.

1. Undo my undoing. Make the locations smaller. For every choice/option there is, the dataset increases exponentially.
2. The same with activities. I'll try to make it logical, rather than fit a certain size.
3. I'm going to add in transport.
4. When they have been joined, I will try to clean up the joined set, so that I can add the incomes together.

I will also ultimately need to repeat this with visits.

```{r}
# cleaning data again before modelling
location_spend <- read_csv("raw_data/tourism_day_visits_location.csv") %>%
  clean_names() %>%
  select(-feature_code, -measurement) %>%
  rename(year = "date_code",
         unit = "units") %>%
  mutate(type_of_location_visited = 
           case_when(type_of_location_visited == "City/large town"
                     ~ "City/large town",
                     type_of_location_visited == "Rural countryside"
                     ~ "Rural countryside",
                     type_of_location_visited == "Seaside - beach" ~ "Seaside",
                     type_of_location_visited == "Seaside - other" ~ "Seaside",
                     type_of_location_visited == "Seaside resort or town"
                     ~ "Seaside",
                     type_of_location_visited == "Small town" ~ "Small town",
                     type_of_location_visited == "Village" ~ "Village",
                     type_of_location_visited == "All areas" ~ "Other")) %>%
  mutate(unit = ifelse(unit == "million pounds (GBP)",
                       "million (£)", "million")) %>%
  relocate(value, .after = year) %>%
  relocate(breakdown_of_domestic_tourism, .after = unit) %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  group_by(year, type_of_location_visited) %>%
  summarise(total_sum_location = sum(value))  
  
activities_spend <- activities %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  mutate(activity_type = case_when(activity_type == "Shopping" ~ "Leisure activity",
                                   activity_type == "Watch live sports" ~  "Entertainment",
                                   activity_type == "Night out" ~  "Evening out",
                                   activity_type == "Attend personal event" ~ "Family/friends",
                                   activity_type == "Leisure activity" ~ "Leisure activity",
                                   activity_type == "Sports participation" ~ "Leisure activity",
                                   activity_type == "Attend public event" ~ "Entertainment",
                                   activity_type == "Eating out" ~  "Evening out",
                                   activity_type == "Day out (spa)" ~ "Attraction/Day trip",
                                   activity_type == "Outdoor leisure activity" ~ "Leisure activity",
                                   activity_type == "Visitor attraction" ~  "Attraction/Day trip",
                                   activity_type == "Day out" ~ "Attraction/Day trip",
                                   activity_type == "Entertainment - cinema etc." ~  "Entertainment",
                                   activity_type == "Day trip - leisure" ~  "Attraction/Day trip",
                                   activity_type == "Visit family/friends" ~  "Family/friends",
                                   activity_type == "Other" ~ "Other")) %>%
  select(-unit, -breakdown_of_domestic_tourism) %>%
  group_by(year, activity_type) %>%
  summarise(total_sum_activity = sum(value))
```

### Joined data for modelling

This is what needs sanity checking - activities and location joined (spend)
```{r}
spend_joined <- inner_join(activities_spend, location_spend, by = "year")

spend_joined <- spend_joined %>%
  relocate(total_sum_location, .before = type_of_location_visited)

spend_joined <- spend_joined %>%
  group_by(type_of_location_visited) %>%
  mutate(sum_spend_activity_per_location = total_sum_activity + total_sum_location) %>%
  select(-total_sum_activity, -total_sum_location)

```
### Visits joined 

I will repeat this process with visits - which should be a lot more straight forward, given that I have already done it with spend
```{r}
location_visits <- read_csv("raw_data/tourism_day_visits_location.csv") %>%
  clean_names() %>%
  select(-feature_code, -measurement) %>%
  rename(year = "date_code",
         unit = "units") %>%  
  mutate(type_of_location_visited = 
           case_when(type_of_location_visited == "City/large town"
                     ~ "City/large town",
                     type_of_location_visited == "Rural countryside"
                     ~ "Rural countryside",
                     type_of_location_visited == "Seaside - beach" ~ "Seaside",
                     type_of_location_visited == "Seaside - other" ~ "Seaside",
                     type_of_location_visited == "Seaside resort or town"
                     ~ "Seaside",
                     type_of_location_visited == "Small town" ~ "Small town",
                     type_of_location_visited == "Village" ~ "Village",
                     type_of_location_visited == "All areas" ~ "Other")) %>%
  mutate(unit = ifelse(unit == "million pounds (GBP)",
                       "million (£)", "million")) %>%
  relocate(value, .after = year) %>%
  relocate(breakdown_of_domestic_tourism, .after = unit) %>%
  filter(breakdown_of_domestic_tourism == "Visits") %>%
  group_by(year, type_of_location_visited) %>%
  summarise(total_sum_location = sum(value))

activities_visits <- activities %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  mutate(activity_type = case_when(activity_type == "Shopping" ~ "Leisure activity",
                                   activity_type == "Watch live sports" ~  "Entertainment",
                                   activity_type == "Night out" ~  "Evening out",
                                   activity_type == "Attend personal event" ~ "Family/friends",
                                   activity_type == "Leisure activity" ~ "Leisure activity",
                                   activity_type == "Sports participation" ~ "Leisure activity",
                                   activity_type == "Attend public event" ~ "Entertainment",
                                   activity_type == "Eating out" ~  "Evening out",
                                   activity_type == "Day out (spa)" ~ "Attraction/Day trip",
                                   activity_type == "Outdoor leisure activity" ~ "Leisure activity",
                                   activity_type == "Visitor attraction" ~  "Attraction/Day trip",
                                   activity_type == "Day out" ~ "Attraction/Day trip",
                                   activity_type == "Entertainment - cinema etc." ~  "Entertainment",
                                   activity_type == "Day trip - leisure" ~  "Attraction/Day trip",
                                   activity_type == "Visit family/friends" ~  "Family/friends",
                                   activity_type == "Other" ~ "Other")) %>%
  select(-unit, -breakdown_of_domestic_tourism) %>%
  group_by(year, activity_type) %>%
  summarise(total_sum_activity = sum(value))

```

### Get this checked too!!
activities and location joined (visits)
```{r}
visits_joined <- inner_join(activities_visits, location_visits, by = "year")

visits_joined <- visits_joined %>%
  relocate(total_sum_location, .before = type_of_location_visited)

visits_joined <- visits_joined %>%
  group_by(type_of_location_visited) %>%
  mutate(sum_visits_activity_per_location = total_sum_activity + total_sum_location) %>%
  select(-total_sum_activity, -total_sum_location)
```

### Repeating with transport, and adding this into the datasets

```{r}
# transport_spend
transport_spend <- transport %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  mutate(travel_type = case_when(travel_type == "Bicycle" ~ "Walked/Bicycle",
                                 travel_type == "Boat/Ship/Ferry" ~ "Boat/Ship/Ferry",
                                 travel_type == "Bus" ~ "Public transport",
                                 travel_type == "Car" ~ "Car/Caravan",
                                 travel_type == "Caravan" ~ "Car/Caravan",
                                 travel_type == "Lorry" ~ "Other",
                                 travel_type == "Motorcycle" ~ "Motorcycle",
                                 travel_type == "Other" ~ "Other",
                                 travel_type == "Plane" ~ "Plane",
                                 travel_type == "Taxi" ~ "Taxi",
                                 travel_type == "Train" ~ "Public transport",
                                 travel_type == "Tram" ~ "Public transport",
                                 travel_type == "Tube" ~ "Public transport",
                                 travel_type == "Walked" ~ "Walked/Bicycle",
                                 travel_type == "Other" ~ "Other")) %>%
  relocate(value, .after = year) %>%
  relocate(breakdown_of_domestic_tourism, .after = unit) %>%
  group_by(year, travel_type) %>%
  summarise(total_sum_transport = sum(value))  

```

Transport joined with activities and location (spend)
```{r}
# joining transport with the joined set

spend_joined_transport <- spend_joined %>%
  inner_join(transport_spend, by = "year") %>%
  group_by(travel_type) %>%
  mutate(sum_transport_per_activity_per_location = sum_spend_activity_per_location + total_sum_transport) %>%
  select(-sum_spend_activity_per_location, -total_sum_transport)

```

```{r}
# transport_visit
transport_visit <- transport %>%
  filter(breakdown_of_domestic_tourism == "Visits") %>%
  mutate(travel_type = case_when(travel_type == "Bicycle" ~ "Walked/Bicycle",
                                 travel_type == "Boat/Ship/Ferry" ~ "Boat/Ship/Ferry",
                                 travel_type == "Bus" ~ "Public transport",
                                 travel_type == "Car" ~ "Car/Caravan",
                                 travel_type == "Caravan" ~ "Car/Caravan",
                                 travel_type == "Lorry" ~ "Other",
                                 travel_type == "Motorcycle" ~ "Motorcycle",
                                 travel_type == "Other" ~ "Other",
                                 travel_type == "Plane" ~ "Plane",
                                 travel_type == "Taxi" ~ "Taxi",
                                 travel_type == "Train" ~ "Public transport",
                                 travel_type == "Tram" ~ "Public transport",
                                 travel_type == "Tube" ~ "Public transport",
                                 travel_type == "Walked" ~ "Walked/Bicycle",
                                 travel_type == "Other" ~ "Other")) %>%
  relocate(value, .after = year) %>%
  relocate(breakdown_of_domestic_tourism, .after = unit) %>%
  group_by(year, travel_type) %>%
  summarise(total_sum_transport = sum(value))  
```


Transport joined with activities and location (visits)
```{r}
# joining tranport with the visit dataset

visits_joined_transport <- visits_joined %>%
  inner_join(transport_spend, by = "year") %>%
  group_by(travel_type) %>%
  mutate(sum_transport_per_activity_per_location = sum_visits_activity_per_location + total_sum_transport) %>%
  select(-sum_visits_activity_per_location, -total_sum_transport)

```

### Modelling

I may now be ready to build models again - depending on if these datasets are okay?


### Conclusions





