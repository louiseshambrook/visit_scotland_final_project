---
title: "R Notebook"
output: html_notebook
---
Modelling notes - no longer used


### - Preparing data for modelling notes
- before asking for help, try:
add a surrogate key to each datasset using
mutate()
row_numbe()

(possibly delete the previous datasets I create for python)

```{r}
activities_test_two <- activities %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  mutate(activity_id = row_number()) %>%
  relocate(activity_id, .before = year) %>%
  select(activity_id, year, value, activity_type) %>%
  group_by(year, activity_type) %>%
  summarise(income_per_year = sum(value))

transport_test_two <- transport %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  mutate(transport_id = row_number()) %>%
  relocate(transport_id, .before = year) %>%
  select(transport_id, year, value, travel_type) %>%
  group_by(year, travel_type) %>%
  mutate(income_per_year = sum(value)) 

joined_table <- inner_join(activities_test_two, transport_test_two, by = "year")

joined_table %>%
  group_by(year, activity_type, travel_type) %>%
  summarise(income_per_year = sum(value.x))
```

Another idea I had, was adding together income
this may be duplicate values - but still?
```{r}
activities %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  group_by(year) %>%
  summarise(total_income_per_year = sum(value))

demographics %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  group_by(year) %>%
  summarise(total_income_per_year = sum(value))

location %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  group_by(year) %>%
  summarise(total_income_per_year = sum(value))
```
Continuing on from this idea
I will focus on activities and location, just to make my life easier
It seems like I could shape the data to join it, i.e. location has 8 observations per year, and activities has 16
So I can either
Double up (which is what I don't want to do)
Or I can go the other way, that I considered, and join them together into 8, so they *should* join together nicely?

First, I'll check for how many observations there are per year
```{r}
activities %>%
  filter(breakdown_of_domestic_tourism == "Expenditure" & year == "2019")

location %>%
    filter(breakdown_of_domestic_tourism == "Expenditure" & year == "2019")
```
Checking through all the years, there are indeed 8 and 16.

So, these are the steps I will do.

1. stick to activities and location
2. change the cleaning of location back to differentiate between the seasides
3. mutate the activity down to 8 types
4. join them together, by year
5. add the values together
6. complete a linear regression in R


```{r}
# cleaning data to join - test
activities_redone <- activities %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  mutate(activity_type = case_when(activity_type == "Shopping" ~ "Shopping",
                                   activity_type == "Watch live sports" ~  "Live entertainment",
                                   activity_type == "Night out" ~  "Evening out",
                                   activity_type == "Attend personal event" ~ "Family/friends",
                                   activity_type == "Leisure activity" ~ "Leisure activity",
                                   activity_type == "Sports participation" ~ "Leisure activity",
                                   activity_type == "Attend public event" ~ "Live entertainment",
                                   activity_type == "Eating out" ~  "Evening out",
                                   activity_type == "Day out (spa)" ~ "Day trip",
                                   activity_type == "Outdoor leisure activity" ~ "Leisure activity",
                                   activity_type == "Visitor attraction" ~  "Visit attraction",
                                   activity_type == "Day out" ~ "Day trip",
                                   activity_type == "Entertainment - cinema etc." ~  "Live entertainment",
                                   activity_type == "Day trip - leisure" ~  "Day trip",
                                   activity_type == "Visit family/friends" ~  "Family/friends",
                                   activity_type == "Other" ~ "Other")) 

```

```{r}
# test join dataset
joined_set <- inner_join(activities_redone, location_redone, by = "year")

joined_set %>%
  arrange(year)
```
I think this is definitely the right track.

I think I'm going to do it again, for the last time, with some differences.

1. Undo my undoing. Make the locations smaller. For every choice/option there is, the dataset increases exponentially.
2. The same with activities. I'll try to make it logical, rather than fit a certain size.
3. I'm going to add in transport.
4. When they have been joined, I will try to clean up the joined set, so that I can add the incomes together.

I will also ultimately need to repeat this with visits.

```{r}
# cleaning data again before modelling
location_spend <- read_csv("raw_data/tourism_day_visits_location.csv") %>%
  clean_names() %>%
  select(-feature_code, -measurement) %>%
  rename(year = "date_code",
         unit = "units") %>%
  mutate(type_of_location_visited = 
           case_when(type_of_location_visited == "City/large town"
                     ~ "City/large town",
                     type_of_location_visited == "Rural countryside"
                     ~ "Rural countryside",
                     type_of_location_visited == "Seaside - beach" ~ "Seaside",
                     type_of_location_visited == "Seaside - other" ~ "Seaside",
                     type_of_location_visited == "Seaside resort or town"
                     ~ "Seaside",
                     type_of_location_visited == "Small town" ~ "Small town",
                     type_of_location_visited == "Village" ~ "Village",
                     type_of_location_visited == "All areas" ~ "Other")) %>%
  mutate(unit = ifelse(unit == "million pounds (GBP)",
                       "million (£)", "million")) %>%
  relocate(value, .after = year) %>%
  relocate(breakdown_of_domestic_tourism, .after = unit) %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  group_by(year, type_of_location_visited) %>%
  summarise(total_sum_location = sum(value))  
  
activities_spend <- activities %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  mutate(activity_type = case_when(activity_type == "Shopping" ~ "Leisure activity",
                                   activity_type == "Watch live sports" ~  "Entertainment",
                                   activity_type == "Night out" ~  "Evening out",
                                   activity_type == "Attend personal event" ~ "Family/friends",
                                   activity_type == "Leisure activity" ~ "Leisure activity",
                                   activity_type == "Sports participation" ~ "Leisure activity",
                                   activity_type == "Attend public event" ~ "Entertainment",
                                   activity_type == "Eating out" ~  "Evening out",
                                   activity_type == "Day out (spa)" ~ "Attraction/Day trip",
                                   activity_type == "Outdoor leisure activity" ~ "Leisure activity",
                                   activity_type == "Visitor attraction" ~  "Attraction/Day trip",
                                   activity_type == "Day out" ~ "Attraction/Day trip",
                                   activity_type == "Entertainment - cinema etc." ~  "Entertainment",
                                   activity_type == "Day trip - leisure" ~  "Attraction/Day trip",
                                   activity_type == "Visit family/friends" ~  "Family/friends",
                                   activity_type == "Other" ~ "Other")) %>%
  select(-unit, -breakdown_of_domestic_tourism) %>%
  group_by(year, activity_type) %>%
  summarise(total_sum_activity = sum(value))
```

### Joined data for modelling

This is what needs sanity checking - activities and location joined (spend)
```{r}
spend_joined <- inner_join(activities_spend, location_spend, by = "year")

spend_joined <- spend_joined %>%
  relocate(total_sum_location, .before = type_of_location_visited)

spend_joined <- spend_joined %>%
  group_by(type_of_location_visited) %>%
  mutate(sum_spend_activity_per_location = total_sum_activity + total_sum_location) %>%
  select(-total_sum_activity, -total_sum_location)

```
### Visits joined 

I will repeat this process with visits - which should be a lot more straight forward, given that I have already done it with spend
```{r}
location_visits <- read_csv("raw_data/tourism_day_visits_location.csv") %>%
  clean_names() %>%
  select(-feature_code, -measurement) %>%
  rename(year = "date_code",
         unit = "units") %>%  
  mutate(type_of_location_visited = 
           case_when(type_of_location_visited == "City/large town"
                     ~ "City/large town",
                     type_of_location_visited == "Rural countryside"
                     ~ "Rural countryside",
                     type_of_location_visited == "Seaside - beach" ~ "Seaside",
                     type_of_location_visited == "Seaside - other" ~ "Seaside",
                     type_of_location_visited == "Seaside resort or town"
                     ~ "Seaside",
                     type_of_location_visited == "Small town" ~ "Small town",
                     type_of_location_visited == "Village" ~ "Village",
                     type_of_location_visited == "All areas" ~ "Other")) %>%
  mutate(unit = ifelse(unit == "million pounds (GBP)",
                       "million (£)", "million")) %>%
  relocate(value, .after = year) %>%
  relocate(breakdown_of_domestic_tourism, .after = unit) %>%
  filter(breakdown_of_domestic_tourism == "Visits") %>%
  group_by(year, type_of_location_visited) %>%
  summarise(total_sum_location = sum(value))

activities_visits <- activities %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  mutate(activity_type = case_when(activity_type == "Shopping" ~ "Leisure activity",
                                   activity_type == "Watch live sports" ~  "Entertainment",
                                   activity_type == "Night out" ~  "Evening out",
                                   activity_type == "Attend personal event" ~ "Family/friends",
                                   activity_type == "Leisure activity" ~ "Leisure activity",
                                   activity_type == "Sports participation" ~ "Leisure activity",
                                   activity_type == "Attend public event" ~ "Entertainment",
                                   activity_type == "Eating out" ~  "Evening out",
                                   activity_type == "Day out (spa)" ~ "Attraction/Day trip",
                                   activity_type == "Outdoor leisure activity" ~ "Leisure activity",
                                   activity_type == "Visitor attraction" ~  "Attraction/Day trip",
                                   activity_type == "Day out" ~ "Attraction/Day trip",
                                   activity_type == "Entertainment - cinema etc." ~  "Entertainment",
                                   activity_type == "Day trip - leisure" ~  "Attraction/Day trip",
                                   activity_type == "Visit family/friends" ~  "Family/friends",
                                   activity_type == "Other" ~ "Other")) %>%
  select(-unit, -breakdown_of_domestic_tourism) %>%
  group_by(year, activity_type) %>%
  summarise(total_sum_activity = sum(value))

```

### Get this checked too!!
activities and location joined (visits)
```{r}
visits_joined <- inner_join(activities_visits, location_visits, by = "year")

visits_joined <- visits_joined %>%
  relocate(total_sum_location, .before = type_of_location_visited)

visits_joined <- visits_joined %>%
  group_by(type_of_location_visited) %>%
  mutate(sum_visits_activity_per_location = total_sum_activity + total_sum_location) %>%
  select(-total_sum_activity, -total_sum_location)
```

### Repeating with transport, and adding this into the datasets

```{r}
# transport_spend
transport_spend <- transport %>%
  filter(breakdown_of_domestic_tourism == "Expenditure") %>%
  mutate(travel_type = case_when(travel_type == "Bicycle" ~ "Walked/Bicycle",
                                 travel_type == "Boat/Ship/Ferry" ~ "Boat/Ship/Ferry",
                                 travel_type == "Bus" ~ "Public transport",
                                 travel_type == "Car" ~ "Car/Caravan",
                                 travel_type == "Caravan" ~ "Car/Caravan",
                                 travel_type == "Lorry" ~ "Other",
                                 travel_type == "Motorcycle" ~ "Motorcycle",
                                 travel_type == "Other" ~ "Other",
                                 travel_type == "Plane" ~ "Plane",
                                 travel_type == "Taxi" ~ "Taxi",
                                 travel_type == "Train" ~ "Public transport",
                                 travel_type == "Tram" ~ "Public transport",
                                 travel_type == "Tube" ~ "Public transport",
                                 travel_type == "Walked" ~ "Walked/Bicycle",
                                 travel_type == "Other" ~ "Other")) %>%
  relocate(value, .after = year) %>%
  relocate(breakdown_of_domestic_tourism, .after = unit) %>%
  group_by(year, travel_type) %>%
  summarise(total_sum_transport = sum(value))  

```

Transport joined with activities and location (spend)
```{r}
# joining transport with the joined set

spend_joined_transport <- spend_joined %>%
  inner_join(transport_spend, by = "year") %>%
  group_by(travel_type) %>%
  mutate(sum_transport_per_activity_per_location = sum_spend_activity_per_location + total_sum_transport) %>%
  select(-sum_spend_activity_per_location, -total_sum_transport)

```

```{r}
# transport_visit
transport_visit <- transport %>%
  filter(breakdown_of_domestic_tourism == "Visits") %>%
  mutate(travel_type = case_when(travel_type == "Bicycle" ~ "Walked/Bicycle",
                                 travel_type == "Boat/Ship/Ferry" ~ "Boat/Ship/Ferry",
                                 travel_type == "Bus" ~ "Public transport",
                                 travel_type == "Car" ~ "Car/Caravan",
                                 travel_type == "Caravan" ~ "Car/Caravan",
                                 travel_type == "Lorry" ~ "Other",
                                 travel_type == "Motorcycle" ~ "Motorcycle",
                                 travel_type == "Other" ~ "Other",
                                 travel_type == "Plane" ~ "Plane",
                                 travel_type == "Taxi" ~ "Taxi",
                                 travel_type == "Train" ~ "Public transport",
                                 travel_type == "Tram" ~ "Public transport",
                                 travel_type == "Tube" ~ "Public transport",
                                 travel_type == "Walked" ~ "Walked/Bicycle",
                                 travel_type == "Other" ~ "Other")) %>%
  relocate(value, .after = year) %>%
  relocate(breakdown_of_domestic_tourism, .after = unit) %>%
  group_by(year, travel_type) %>%
  summarise(total_sum_transport = sum(value))  
```


Transport joined with activities and location (visits)
```{r}
# joining tranport with the visit dataset

visits_joined_transport <- visits_joined %>%
  inner_join(transport_spend, by = "year") %>%
  group_by(travel_type) %>%
  mutate(sum_transport_per_activity_per_location = sum_visits_activity_per_location + total_sum_transport) %>%
  select(-sum_visits_activity_per_location, -total_sum_transport)

```

### Modelling

I may now be ready to build models again - depending on if these datasets are okay?
